<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NIM Game</title>
</head>
<body>
<h1>Welcome to the infamous name of NIM!</h1>
<p>In this game, NIM plays first. Each player can alternatively move 1, 3, or 4 coins (with the condition that you are not removing more coins than exist). The player to remove the last coin wins.</p>
<p>How many coins do you want to start with?</p>
<input type="number" id="startCoins">
<button onclick="startGame()">Start Game</button>

<div id="coinStack"></div>

<script>
function startGame() {
    try {
        var ncoin = parseInt(document.getElementById("startCoins").value);
        if (isNaN(ncoin)) {
            throw "Input is not a number";
        }
        console.log("nim moves first");
        nimMoves(ncoin);
    } catch (error) {
        alert("Please enter a valid numeric value.");
    }
}

function askForMove(num) {
    var usermove = parseInt(prompt("There are " + num + " coins left, how many do you want to remove (1, 3, 4)?"));
    if (!isNaN(usermove)) {
        if (usermove !== 1 && usermove !== 3 && usermove !== 4 || usermove > num) {
            alert("Try again, only 1, 3, or 4 coins can be removed, and you cannot remove more coins than exist");
            askForMove(num);
        } else {
            num -= usermove;
            if (num === 0) {
                alert("THE USER WINS! CONGRATULATIONS");
                return;
            }
            nimMoves(num);
        }
    } else {
        alert("Try again, enter a numeric value of 1, 3, or 4");
        askForMove(num);
    }
}

function nimMoves(num) {
    var choice = 0;
    if (num % 7 === 1 || num % 7 === 2 || num % 7 === 3 || num % 7 === 0) {
        choice = 1;
    } else if (num % 7 === 5) {
        choice = 3;
    } else if (num % 7 === 4 || num % 7 === 6) {
        choice = 4;
    }
    num -= choice;
    console.log("Nim removes " + choice + " coin(s)");
    if (num === 0) {
        alert("NIM WINS! BWA-HA-HA-HA-HA! NIM TAKES OVER");
        return;
    }
    console.log("The following is the stack of coins after " + choice + " coin(s) were removed");
    var stack = document.getElementById("coinStack");
    stack.innerHTML = "";
    for (var i = 0; i < num; i++) {
        if (i === 0) {
            stack.innerHTML += "_____<br>";
        }
        stack.innerHTML += "|____|<br>";
    }
    askForMove(num);
}
</script>
</body>
</html>
